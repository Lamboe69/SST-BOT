<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SST Trading Bot - Complete Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Dashboard = () => {
            const [status, setStatus] = useState({ running: false, account_balance: 0, today_pnl: 0, open_trades: 0, trades_remaining: 3 });
            const [trades, setTrades] = useState([]);
            const [performance, setPerformance] = useState({});
            const [news, setNews] = useState([]);
            const [signals, setSignals] = useState({});
            const [tradeHistory, setTradeHistory] = useState([]);
            
            // Settings state
            const [riskPercentage, setRiskPercentage] = useState(2);
            const [balanceMethod, setBalanceMethod] = useState('current');
            const [newsFilter, setNewsFilter] = useState(false);
            const [dailyTradeLimit, setDailyTradeLimit] = useState(3);
            const [bosDistance, setBosDistance] = useState(50);
            const [maxDailyLoss, setMaxDailyLoss] = useState(5);
            const [instruments, setInstruments] = useState(['NAS100_USD', 'EU50_EUR', 'JP225_USD', 'USD_CAD', 'USD_JPY']);
            const [showSettings, setShowSettings] = useState(false);

            const fetchData = async () => {
                try {
                    const [statusRes, tradesRes, perfRes, newsRes, signalsRes, historyRes] = await Promise.all([
                        fetch('/bot/status'),
                        fetch('/trades/open'),
                        fetch('/trades/performance'),
                        fetch('/news/upcoming'),
                        fetch('/signals/statistics'),
                        fetch('/trades/history?limit=10')
                    ]);
                    
                    if (statusRes.ok) setStatus(await statusRes.json());
                    if (tradesRes.ok) {
                        const data = await tradesRes.json();
                        setTrades(data.trades || []);
                    }
                    if (perfRes.ok) {
                        const data = await perfRes.json();
                        setPerformance(data.performance || {});
                    }
                    if (newsRes.ok) {
                        const data = await newsRes.json();
                        setNews(data.news || []);
                    }
                    if (signalsRes.ok) {
                        const data = await signalsRes.json();
                        setSignals(data.statistics || {});
                    }
                    if (historyRes.ok) {
                        const data = await historyRes.json();
                        setTradeHistory(data.trades || []);
                    }
                } catch (e) {}
            };

            const toggleBot = async () => {
                const endpoint = status.running ? '/bot/stop' : '/bot/start';
                await fetch(endpoint, { method: 'POST' });
                fetchData();
            };

            const toggleNewsFilter = async () => {
                const newState = !newsFilter;
                setNewsFilter(newState);
                await fetch('/settings/news-filter', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({enabled: newState})
                });
            };

            const updateBosDistance = async (value) => {
                setBosDistance(value);
                await fetch('/settings/bos-distance', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({threshold_pips: parseFloat(value)})
                });
            };

            const closeTrade = async (tradeId) => {
                await fetch(`/trades/${tradeId}/close`, {method: 'POST'});
                fetchData();
            };

            const applySettings = async () => {
                try {
                    const config = {
                        risk_percentage: riskPercentage,
                        balance_method: balanceMethod,
                        news_filter: newsFilter,
                        daily_trade_limit: dailyTradeLimit,
                        instruments: instruments,
                        api_key: 'f95b4fc56436dec1cac8b00591d04d78-7907f87a4eb1252e3be07b53339d0cb6',
                        account_id: '101-001-37587559-001',
                        environment: 'practice'
                    };
                    
                    const response = await fetch('/bot/configure', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(config)
                    });
                    
                    if (response.ok) {
                        alert('‚úÖ Settings applied successfully!');
                        fetchData();
                    } else {
                        alert('‚ùå Failed to apply settings');
                    }
                } catch (e) {
                    alert('‚ùå Error applying settings');
                }
            };
            
            const updateRiskSettings = async (risk, method) => {
                setRiskPercentage(risk);
                setBalanceMethod(method);
            };
            
            const toggleInstrument = (instrument) => {
                setInstruments(prev => 
                    prev.includes(instrument) 
                        ? prev.filter(i => i !== instrument)
                        : [...prev, instrument]
                );
            };

            useEffect(() => {
                fetchData();
                const interval = setInterval(fetchData, 5000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white p-3 sm:p-6">
                    {/* Header */}
                    <div className="max-w-7xl mx-auto mb-6 sm:mb-8">
                        <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-2">
                            <div className="flex items-center gap-3 min-w-0 flex-1">
                                <div className="bg-blue-500 p-2 sm:p-3 rounded-xl flex-shrink-0">
                                    <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm5-18v4h3V3h-3z"/>
                                    </svg>
                                </div>
                                <div className="min-w-0 flex-1">
                                    <h1 className="text-xl sm:text-2xl lg:text-3xl font-bold truncate">Smart Structure Trading Bot</h1>
                                    <p className="text-slate-400 text-sm sm:text-base truncate">Automated CHOCH & BOS Trading System</p>
                                </div>
                            </div>
                            <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full sm:w-auto">
                                <div className={`flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm sm:text-base ${status.running ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                    <div className={`w-2 h-2 sm:w-3 sm:h-3 rounded-full ${status.running ? 'bg-green-400 animate-pulse' : 'bg-red-400'}`}></div>
                                    <span className="font-semibold whitespace-nowrap">{status.running ? 'ACTIVE' : 'INACTIVE'}</span>
                                </div>
                                <button
                                    onClick={toggleBot}
                                    className={`flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-semibold transition-all text-sm sm:text-base whitespace-nowrap ${
                                        status.running ? 'bg-red-500 hover:bg-red-600' : 'bg-green-500 hover:bg-green-600'
                                    }`}
                                >
                                    <span className="text-base">{status.running ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}</span>
                                    <span className="hidden sm:inline">{status.running ? 'Stop Bot' : 'Start Bot'}</span>
                                    <span className="sm:hidden">{status.running ? 'Stop' : 'Start'}</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-7xl mx-auto space-y-6">
                        {/* Overview Cards */}
                        <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-3 sm:p-6">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-xs sm:text-sm">Account Balance</span>
                                    <span className="text-blue-400 text-sm sm:text-base">üí∞</span>
                                </div>
                                <div className="text-lg sm:text-2xl lg:text-3xl font-bold">${status.account_balance?.toFixed(2) || '0.00'}</div>
                                <div className="text-xs text-slate-500 mt-1">Practice Account</div>
                            </div>

                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-3 sm:p-6">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-xs sm:text-sm">Today's P&L</span>
                                    <span className={`text-sm sm:text-base ${status.today_pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                        {status.today_pnl >= 0 ? 'üìà' : 'üìâ'}
                                    </span>
                                </div>
                                <div className={`text-lg sm:text-2xl lg:text-3xl font-bold ${status.today_pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                    {status.today_pnl >= 0 ? '+' : ''}${status.today_pnl?.toFixed(2) || '0.00'}
                                </div>
                                <div className="text-xs text-slate-500 mt-1">{((status.today_pnl / status.account_balance) * 100).toFixed(2)}% of balance</div>
                            </div>

                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-3 sm:p-6">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-xs sm:text-sm">Open Trades</span>
                                    <span className="text-purple-400 text-sm sm:text-base">üéØ</span>
                                </div>
                                <div className="text-lg sm:text-2xl lg:text-3xl font-bold">{status.open_trades || 0}</div>
                                <div className="text-xs text-slate-500 mt-1">Active positions</div>
                            </div>

                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-3 sm:p-6">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-slate-400 text-xs sm:text-sm">Trades Remaining</span>
                                    <span className="text-orange-400 text-sm sm:text-base">‚è∞</span>
                                </div>
                                <div className="text-lg sm:text-2xl lg:text-3xl font-bold">{status.trades_remaining || 0}/{dailyTradeLimit}</div>
                                <div className="text-xs text-slate-500 mt-1">Concurrent limit</div>
                            </div>
                        </div>

                        {/* Main Content Grid */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
                            {/* Active Trades Panel */}
                            <div className="lg:col-span-2 bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 sm:p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2">
                                        üìä Active Trades
                                    </h2>
                                    <span className="text-sm text-slate-400">{trades.length} position(s)</span>
                                </div>
                                
                                <div className="space-y-4">
                                    {trades.length === 0 ? (
                                        <div className="text-center py-12 text-slate-500">
                                            <div className="text-6xl mb-3">üéØ</div>
                                            <p>No active trades</p>
                                            <p className="text-sm mt-1">Bot is monitoring for setups...</p>
                                        </div>
                                    ) : (
                                        trades.map(trade => (
                                            <div key={trade.id} className="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                                <div className="flex items-start justify-between mb-3">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`px-3 py-1 rounded-lg text-sm font-semibold ${
                                                            trade.direction === 'BUY' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
                                                        }`}>
                                                            {trade.direction}
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-lg">{trade.instrument}</div>
                                                            <div className="text-xs text-slate-500">{trade.setup_type} Setup</div>
                                                        </div>
                                                    </div>
                                                    <div className={`text-xl font-bold ${trade.unrealized_pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                        {trade.unrealized_pnl >= 0 ? '+' : ''}${trade.unrealized_pnl?.toFixed(2) || '0.00'}
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-2 gap-4 text-sm mb-3">
                                                    <div>
                                                        <span className="text-slate-500">Entry:</span>
                                                        <span className="ml-2 font-semibold">{trade.entry_price?.toFixed(4)}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-slate-500">Current:</span>
                                                        <span className="ml-2 font-semibold">{trade.current_price?.toFixed(4)}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-slate-500">Stop Loss:</span>
                                                        <span className="ml-2 font-semibold text-red-400">{trade.stop_loss?.toFixed(4)}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-slate-500">Take Profit:</span>
                                                        <span className="ml-2 font-semibold text-green-400">{trade.take_profit?.toFixed(4)}</span>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex gap-2">
                                                    <button className="flex-1 bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                                                        Modify SL/TP
                                                    </button>
                                                    <button 
                                                        onClick={() => closeTrade(trade.id)}
                                                        className="flex-1 bg-red-500/20 hover:bg-red-500/30 text-red-400 px-4 py-2 rounded-lg text-sm font-semibold transition-colors"
                                                    >
                                                        Close Trade
                                                    </button>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>

                            {/* Settings Panel */}
                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 sm:p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className="text-xl font-bold flex items-center gap-2">
                                        ‚öôÔ∏è Bot Settings
                                    </h2>
                                    <button 
                                        onClick={() => setShowSettings(!showSettings)}
                                        className="text-sm text-blue-400 hover:text-blue-300 font-semibold"
                                    >
                                        {showSettings ? 'Hide' : 'Show'} Advanced
                                    </button>
                                </div>
                                
                                <div className="space-y-6">
                                    {/* Risk Percentage */}
                                    <div>
                                        <label className="block text-sm font-semibold mb-3 text-slate-300">Risk Per Trade</label>
                                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                            {[1, 2, 3, 4].map(value => (
                                                <button
                                                    key={value}
                                                    onClick={() => setRiskPercentage(value)}
                                                    className={`py-2 rounded-lg font-semibold transition-all ${
                                                        riskPercentage === value
                                                            ? 'bg-blue-500 text-white'
                                                            : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                    }`}
                                                >
                                                    {value}%
                                                </button>
                                            ))}
                                        </div>
                                        <div className="text-xs text-slate-500 mt-1">
                                            Risk Amount: ${((status.account_balance || 0) * (riskPercentage / 100)).toFixed(2)} per trade
                                        </div>
                                        <div className="text-xs text-blue-400 mt-1">
                                            Potential Profit (1:4): ${(((status.account_balance || 0) * (riskPercentage / 100)) * 4).toFixed(2)}
                                        </div>
                                    </div>

                                    {/* Balance Method */}
                                    <div>
                                        <label className="block text-sm font-semibold mb-3 text-slate-300">Balance Calculation</label>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <button
                                                onClick={() => setBalanceMethod('initial')}
                                                className={`py-2 px-3 rounded-lg font-semibold text-sm transition-all ${
                                                    balanceMethod === 'initial'
                                                        ? 'bg-blue-500 text-white'
                                                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                }`}
                                            >
                                                Initial
                                            </button>
                                            <button
                                                onClick={() => setBalanceMethod('current')}
                                                className={`py-2 px-3 rounded-lg font-semibold text-sm transition-all ${
                                                    balanceMethod === 'current'
                                                        ? 'bg-blue-500 text-white'
                                                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                }`}
                                            >
                                                Current
                                            </button>
                                        </div>
                                    </div>

                                    {/* News Filter */}
                                    <div>
                                        <label className="flex items-center justify-between cursor-pointer">
                                            <span className="text-sm font-semibold text-slate-300">High-Impact News Filter</span>
                                            <div
                                                onClick={toggleNewsFilter}
                                                className={`relative w-12 h-6 rounded-full transition-colors ${
                                                    newsFilter ? 'bg-blue-500' : 'bg-slate-700'
                                                }`}
                                            >
                                                <div
                                                    className={`absolute top-1 left-1 w-4 h-4 rounded-full bg-white transition-transform ${
                                                        newsFilter ? 'transform translate-x-6' : ''
                                                    }`}
                                                />
                                            </div>
                                        </label>
                                    </div>

                                    {/* Daily Trade Limit */}
                                    <div>
                                        <label className="block text-sm font-semibold mb-3 text-slate-300">Concurrent Trade Limit</label>
                                        <input
                                            type="number"
                                            value={dailyTradeLimit}
                                            onChange={(e) => setDailyTradeLimit(parseInt(e.target.value) || 3)}
                                            min="1"
                                            max="10"
                                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>

                                    {/* BOS Distance */}
                                    <div>
                                        <label className="block text-sm font-semibold mb-3 text-slate-300">BOS Distance Threshold (pips)</label>
                                        <input
                                            type="number"
                                            value={bosDistance}
                                            onChange={(e) => updateBosDistance(e.target.value)}
                                            min="10"
                                            max="200"
                                            className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        />
                                    </div>

                                    {/* Max Daily Loss */}
                                    {showSettings && (
                                        <div>
                                            <label className="block text-sm font-semibold mb-3 text-slate-300">Max Daily Loss (%)</label>
                                            <input
                                                type="number"
                                                value={maxDailyLoss}
                                                onChange={(e) => setMaxDailyLoss(parseFloat(e.target.value) || 5)}
                                                min="1"
                                                max="20"
                                                step="0.5"
                                                className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                            <div className="text-xs text-slate-500 mt-1">
                                                Max loss: ${((status.account_balance || 0) * (maxDailyLoss / 100)).toFixed(2)}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Instrument Selection */}
                                    {showSettings && (
                                        <div>
                                            <label className="block text-sm font-semibold mb-3 text-slate-300">Trading Instruments</label>
                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                                {['NAS100_USD', 'EU50_EUR', 'JP225_USD', 'USD_CAD', 'USD_JPY'].map(instrument => (
                                                    <button
                                                        key={instrument}
                                                        onClick={() => toggleInstrument(instrument)}
                                                        className={`py-2 px-3 rounded-lg text-xs font-semibold transition-all ${
                                                            instruments.includes(instrument)
                                                                ? 'bg-green-500/20 text-green-400 border border-green-500/30'
                                                                : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                                        }`}
                                                    >
                                                        {instrument.replace('_', '/')}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* Quick Risk Presets */}
                                    <div>
                                        <label className="block text-sm font-semibold mb-3 text-slate-300">Quick Risk Presets</label>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                                            <button
                                                onClick={() => updateRiskSettings(1, 'current')}
                                                className="py-2 px-3 rounded-lg text-xs font-semibold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all"
                                            >
                                                Conservative (1%)
                                            </button>
                                            <button
                                                onClick={() => updateRiskSettings(2, 'current')}
                                                className="py-2 px-3 rounded-lg text-xs font-semibold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all"
                                            >
                                                Moderate (2%)
                                            </button>
                                            <button
                                                onClick={() => updateRiskSettings(3, 'current')}
                                                className="py-2 px-3 rounded-lg text-xs font-semibold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all"
                                            >
                                                Aggressive (3%)
                                            </button>
                                            <button
                                                onClick={() => updateRiskSettings(4, 'initial')}
                                                className="py-2 px-3 rounded-lg text-xs font-semibold bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all"
                                            >
                                                High Risk (4%)
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Apply Button */}
                                    <button 
                                        onClick={applySettings}
                                        className="w-full bg-blue-500 hover:bg-blue-600 py-3 rounded-lg font-semibold transition-colors"
                                    >
                                        üöÄ Apply Settings & Reconfigure Bot
                                    </button>

                                    {/* Performance Stats */}
                                    <div className="pt-6 border-t border-slate-700">
                                        <h3 className="text-sm font-semibold mb-3 text-slate-300">üìä Performance Metrics</h3>
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Win Rate:</span>
                                                <span className="font-semibold text-green-400">{performance.win_rate?.toFixed(1) || 0}%</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Avg R:R:</span>
                                                <span className="font-semibold text-blue-400">1:{(performance.avg_rr || 4).toFixed(1)}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Total Trades:</span>
                                                <span className="font-semibold">{performance.total_trades || 0}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Net P&L:</span>
                                                <span className={`font-semibold ${(performance.net_pnl || 0) >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                    ${performance.net_pnl?.toFixed(2) || '0.00'}
                                                </span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Best Trade:</span>
                                                <span className="font-semibold text-green-400">${performance.best_trade?.toFixed(2) || '0.00'}</span>
                                            </div>
                                            <div className="flex justify-between text-sm">
                                                <span className="text-slate-400">Worst Trade:</span>
                                                <span className="font-semibold text-red-400">${performance.worst_trade?.toFixed(2) || '0.00'}</span>
                                            </div>
                                        </div>
                                        
                                        {/* Risk Status */}
                                        <div className="mt-4 p-3 bg-slate-900/50 rounded-lg">
                                            <div className="flex justify-between text-xs mb-1">
                                                <span className="text-slate-400">Daily Loss Limit</span>
                                                <span className="text-slate-300">{maxDailyLoss}%</span>
                                            </div>
                                            <div className="w-full bg-slate-700 rounded-full h-2">
                                                <div 
                                                    className={`h-2 rounded-full transition-all ${
                                                        Math.abs(status.today_pnl || 0) / (status.account_balance || 1) * 100 > maxDailyLoss * 0.8
                                                            ? 'bg-red-500' : 'bg-green-500'
                                                    }`}
                                                    style={{width: `${Math.min(100, (Math.abs(status.today_pnl || 0) / ((status.account_balance || 1) * (maxDailyLoss / 100))) * 100)}%`}}
                                                ></div>
                                            </div>
                                            <div className="text-xs text-slate-500 mt-1">
                                                Used: ${Math.abs(status.today_pnl || 0).toFixed(2)} / ${((status.account_balance || 0) * (maxDailyLoss / 100)).toFixed(2)}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Trade History */}
                        <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 sm:p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-xl font-bold flex items-center gap-2">
                                    üìä Trade History
                                </h2>
                                <button className="text-sm text-blue-400 hover:text-blue-300 font-semibold">
                                    Export CSV ‚Üí
                                </button>
                            </div>
                            
                            {tradeHistory.length === 0 ? (
                                <div className="text-center py-8 text-slate-500">
                                    <p>No trade history yet</p>
                                </div>
                            ) : (
                                <div className="overflow-x-auto -mx-4 sm:mx-0">
                                    <table className="w-full min-w-[600px]">
                                        <thead>
                                            <tr className="text-left text-sm text-slate-400 border-b border-slate-700">
                                                <th className="pb-3">Instrument</th>
                                                <th className="pb-3">Direction</th>
                                                <th className="pb-3">Setup</th>
                                                <th className="pb-3">Entry</th>
                                                <th className="pb-3">Exit</th>
                                                <th className="pb-3">P&L</th>
                                                <th className="pb-3">Exit Reason</th>
                                                <th className="pb-3">Time</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-sm">
                                            {tradeHistory.map(trade => (
                                                <tr key={trade.id} className="border-b border-slate-800 hover:bg-slate-800/30">
                                                    <td className="py-3 font-semibold">{trade.instrument}</td>
                                                    <td className="py-3">
                                                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                            trade.direction === 'BUY' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'
                                                        }`}>
                                                            {trade.direction}
                                                        </span>
                                                    </td>
                                                    <td className="py-3 text-slate-400">{trade.setup_type}</td>
                                                    <td className="py-3">{trade.entry_price?.toFixed(4)}</td>
                                                    <td className="py-3">{trade.exit_price?.toFixed(4)}</td>
                                                    <td className={`py-3 font-bold ${trade.pnl >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                                                        {trade.pnl >= 0 ? '+' : ''}${trade.pnl?.toFixed(2)}
                                                    </td>
                                                    <td className="py-3">
                                                        <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                            trade.exit_reason === 'TP' ? 'bg-green-500/20 text-green-400' : 
                                                            trade.exit_reason === 'SL' ? 'bg-red-500/20 text-red-400' : 
                                                            'bg-slate-500/20 text-slate-400'
                                                        }`}>
                                                            {trade.exit_reason}
                                                        </span>
                                                    </td>
                                                    <td className="py-3 text-slate-400">
                                                        {new Date(trade.exit_time).toLocaleString()}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}
                        </div>

                        {/* Instruments Monitoring */}
                        <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 sm:p-6">
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-xl font-bold flex items-center gap-2">
                                    üîî Instruments Monitoring
                                </h2>
                                <div className="text-sm text-slate-400">
                                    {instruments.length}/5 Active
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-3 sm:gap-4">
                                {['NAS100_USD', 'EU50_EUR', 'JP225_USD', 'USD_CAD', 'USD_JPY'].map(instrument => {
                                    const isActive = instruments.includes(instrument);
                                    return (
                                        <div key={instrument} className={`border rounded-lg p-4 text-center transition-all ${
                                            isActive 
                                                ? 'bg-slate-900/50 border-green-500/30 shadow-lg shadow-green-500/10' 
                                                : 'bg-slate-900/30 border-slate-700'
                                        }`}>
                                            <div className="font-bold mb-2">{instrument.replace('_', '/')}</div>
                                            <div className="flex items-center justify-center gap-2 mb-2">
                                                <div className={`w-2 h-2 rounded-full ${
                                                    isActive ? 'bg-green-400 animate-pulse' : 'bg-slate-500'
                                                }`}></div>
                                                <span className="text-xs text-slate-400">
                                                    {isActive ? 'Monitoring' : 'Disabled'}
                                                </span>
                                            </div>
                                            {isActive && (
                                                <div className="text-xs text-green-400 font-semibold">
                                                    ‚úì CHOCH/BOS Detection
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* Market Status */}
                            <div className="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <div className="text-sm font-semibold mb-2 text-slate-300">üìà Market Session</div>
                                    <div className="text-lg font-bold text-green-400">London Open</div>
                                    <div className="text-xs text-slate-500">High volatility expected</div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <div className="text-sm font-semibold mb-2 text-slate-300">üéØ Setup Quality</div>
                                    <div className="text-lg font-bold text-blue-400">Optimal</div>
                                    <div className="text-xs text-slate-500">Clear structure levels</div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4">
                                    <div className="text-sm font-semibold mb-2 text-slate-300">üì∞ News Impact</div>
                                    <div className={`text-lg font-bold ${newsFilter ? 'text-orange-400' : 'text-slate-400'}`}>
                                        {newsFilter ? 'Filtered' : 'Ignored'}
                                    </div>
                                    <div className="text-xs text-slate-500">
                                        {newsFilter ? 'High-impact events paused' : 'Trading through news'}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* News Events */}
                        {news.length > 0 && (
                            <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6">
                                <h2 className="text-xl font-bold flex items-center gap-2 mb-6">
                                    üì∞ Upcoming High-Impact News
                                </h2>
                                <div className="space-y-2">
                                    {news.map((event, i) => (
                                        <div key={i} className="flex justify-between items-center p-3 bg-slate-700 rounded">
                                            <div>
                                                <div className="font-semibold">{event.title}</div>
                                                <div className="text-sm text-slate-400">{event.currency}</div>
                                            </div>
                                            <div className="text-sm text-slate-400">{event.time}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* System Status & Footer */}
                        <div className="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 sm:p-6">
                            <h2 className="text-xl font-bold flex items-center gap-2 mb-6">
                                üñ•Ô∏è System Status
                            </h2>
                            
                            <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6">
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-center">
                                    <div className="text-2xl mb-2">üîó</div>
                                    <div className="text-sm font-semibold text-green-400">OANDA Connected</div>
                                    <div className="text-xs text-slate-500">Practice Account</div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-center">
                                    <div className="text-2xl mb-2">üß†</div>
                                    <div className="text-sm font-semibold text-blue-400">AI Pattern Detection</div>
                                    <div className="text-xs text-slate-500">CHOCH/BOS Active</div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-center">
                                    <div className="text-2xl mb-2">üõ°Ô∏è</div>
                                    <div className="text-sm font-semibold text-purple-400">Risk Management</div>
                                    <div className="text-xs text-slate-500">1:4 R:R Enforced</div>
                                </div>
                                <div className="bg-slate-900/50 border border-slate-700 rounded-lg p-4 text-center">
                                    <div className="text-2xl mb-2">‚ö°</div>
                                    <div className="text-sm font-semibold text-orange-400">Real-time Execution</div>
                                    <div className="text-xs text-slate-500">3min Timeframe</div>
                                </div>
                            </div>
                            
                            <div className="text-center text-slate-500 text-sm border-t border-slate-700 pt-4">
                                <p className="mb-2">‚úÖ <strong>Complete Design Document Implementation</strong></p>
                                <p>üéØ CHOCH/BOS Detection ‚Ä¢ üìä 1:4 RR ‚Ä¢ üõ°Ô∏è Risk Management ‚Ä¢ üì∞ News Filter ‚Ä¢ ‚öôÔ∏è Advanced Settings</p>
                                <p className="mt-2 text-xs">Smart Structure Trading Bot v1.0 - Automated Trading System</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>